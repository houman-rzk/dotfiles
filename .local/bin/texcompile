#!/bin/sh

file=$(readlink -f "$1")
dir=${file%/*}
basename="${file%.*}"

cleanup () {
	rm "$basename.aux" >/dev/null 2>&1
	rm "$basename.toc" >/dev/null 2>&1

    [ "$1" = "--keep-log" ] || rm "$basename.log" >/dev/null 2>&1
}

# Compile the .tex file
{ xelatex --output-directory="$dir" "$file" >/dev/null 2>&1 && cleanup ;} || { echo "ERROR: Could not compile. Check the log." && cleanup --keep-log && sleep 1 ;}
